<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="ChipiTiempo - El tiempo en Chipiona y comarca">
<title>ChipiTiempo - El tiempo en Chipiona</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; max-width: 900px; }
h1, h2, h3 { color: #333; }
hr { border: none; border-top: 1px solid #ddd; margin: 20px 0; }
ul { padding-left: 20px; }
a { color: #0066cc; }
small { color: #666; }
.prov-filter { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 4px; line-height: 2; }
.prov-filter a { white-space: nowrap; }
.munic-filter { margin: 10px 0; padding: 10px; background: #f0f8ff; border-radius: 4px; line-height: 2; border-left: 4px solid #0066cc; }
.munic-filter a { white-space: nowrap; }
.forecast-selector { margin: 15px 0; padding: 10px; background: #e8f5e9; border-radius: 4px; border-left: 4px solid #4caf50; }
.forecast-selector select { padding: 5px 10px; font-size: 14px; border: 1px solid #4caf50; border-radius: 3px; }
.forecast-scroll { overflow-x: auto; }
.forecast { width: 100%; border-collapse: collapse; margin: 8px 0 16px; font-size: 14px; }
.forecast th { background: #2c3e50; color: #fff; padding: 6px 8px; text-align: left; white-space: nowrap; }
.forecast td { padding: 5px 8px; border-bottom: 1px solid #eee; white-space: nowrap; }
.forecast tr:hover { background: #f5f8fc; }
.rain-med { color: #e67e22; font-weight: bold; }
.rain-high { color: #e74c3c; font-weight: bold; }
</style>
</head>
<body>

<h1>ChipiTiempo</h1>

<p><em>Actualizado: 2026-02-09 18:09 UTC</em></p>

<h2>PREVISI&Oacute;N HORARIA</h2>
<div class="forecast-selector">
<strong>Seleccionar municipio:</strong> <select id="municipality-select" onchange="loadForecast(this.value)">
<option value="Algeciras">Algeciras</option>
<option value="Arcos de la Frontera">Arcos de la Frontera</option>
<option value="Barbate">Barbate</option>
<option value="Cádiz (capital)">Cádiz (capital)</option>
<option value="Chiclana de la Frontera">Chiclana de la Frontera</option>
<option value="Chipiona" selected>Chipiona</option>
<option value="Conil de la Frontera">Conil de la Frontera</option>
<option value="El Puerto de Santa María">El Puerto de Santa María</option>
<option value="Espera">Espera</option>
<option value="Grazalema">Grazalema</option>
<option value="Jerez de la Frontera">Jerez de la Frontera</option>
<option value="Jimena de la Frontera">Jimena de la Frontera</option>
<option value="La Línea de la Concepción">La Línea de la Concepción</option>
<option value="Los Barrios">Los Barrios</option>
<option value="Medina-Sidonia">Medina-Sidonia</option>
<option value="Olvera">Olvera</option>
<option value="Prado del Rey">Prado del Rey</option>
<option value="Puerto Real">Puerto Real</option>
<option value="Rota">Rota</option>
<option value="San Fernando">San Fernando</option>
<option value="San Roque">San Roque</option>
<option value="Sanlúcar de Barrameda">Sanlúcar de Barrameda</option>
<option value="Tarifa">Tarifa</option>
<option value="Ubrique">Ubrique</option>
<option value="Vejer de la Frontera">Vejer de la Frontera</option>
</select>
<span id="forecast-loading" style="display:none; margin-left: 10px;">⏳ Cargando...</span>
</div>

<div id="forecast-content"><p>No hay datos de previsi&oacute;n disponibles.</p></div>


<hr>

<h2>ALERTAS Y AVISOS ACTIVOS</h2>

<div class="prov-filter">
<strong>Filtrar por provincia:</strong><br>
<a href="#" onclick="fp('');return false" data-prov="" style="font-weight:bold">Todas</a> | <a href="#" onclick="fp('Cádiz');return false" data-prov="Cádiz">Cádiz</a> | <a href="#" onclick="fp('Huelva');return false" data-prov="Huelva">Huelva</a> | <a href="#" onclick="fp('Sevilla');return false" data-prov="Sevilla">Sevilla</a> | <a href="#" onclick="fp('Málaga');return false" data-prov="Málaga">Málaga</a>
</div>

<div class="munic-filter">
<strong>Filtrar por municipio (Cádiz):</strong><br>
<a href="#" onclick="fm('');return false" data-munic="" style="font-weight:bold">Todos</a> | <a href="#" onclick="fm('Algeciras');return false" data-munic="Algeciras">Algeciras</a> | <a href="#" onclick="fm('Arcos de la Frontera');return false" data-munic="Arcos de la Frontera">Arcos de la Frontera</a> | <a href="#" onclick="fm('Barbate');return false" data-munic="Barbate">Barbate</a> | <a href="#" onclick="fm('Cádiz (capital)');return false" data-munic="Cádiz (capital)">Cádiz (capital)</a> | <a href="#" onclick="fm('Chiclana de la Frontera');return false" data-munic="Chiclana de la Frontera">Chiclana de la Frontera</a> | <a href="#" onclick="fm('Chipiona');return false" data-munic="Chipiona">Chipiona</a> | <a href="#" onclick="fm('Conil de la Frontera');return false" data-munic="Conil de la Frontera">Conil de la Frontera</a> | <a href="#" onclick="fm('El Puerto de Santa María');return false" data-munic="El Puerto de Santa María">El Puerto de Santa María</a> | <a href="#" onclick="fm('Espera');return false" data-munic="Espera">Espera</a> | <a href="#" onclick="fm('Grazalema');return false" data-munic="Grazalema">Grazalema</a> | <a href="#" onclick="fm('Jerez de la Frontera');return false" data-munic="Jerez de la Frontera">Jerez de la Frontera</a> | <a href="#" onclick="fm('Jimena de la Frontera');return false" data-munic="Jimena de la Frontera">Jimena de la Frontera</a> | <a href="#" onclick="fm('La Línea de la Concepción');return false" data-munic="La Línea de la Concepción">La Línea de la Concepción</a> | <a href="#" onclick="fm('Los Barrios');return false" data-munic="Los Barrios">Los Barrios</a> | <a href="#" onclick="fm('Medina-Sidonia');return false" data-munic="Medina-Sidonia">Medina-Sidonia</a> | <a href="#" onclick="fm('Olvera');return false" data-munic="Olvera">Olvera</a> | <a href="#" onclick="fm('Prado del Rey');return false" data-munic="Prado del Rey">Prado del Rey</a> | <a href="#" onclick="fm('Puerto Real');return false" data-munic="Puerto Real">Puerto Real</a> | <a href="#" onclick="fm('Rota');return false" data-munic="Rota">Rota</a> | <a href="#" onclick="fm('San Fernando');return false" data-munic="San Fernando">San Fernando</a> | <a href="#" onclick="fm('San Roque');return false" data-munic="San Roque">San Roque</a> | <a href="#" onclick="fm('Sanlúcar de Barrameda');return false" data-munic="Sanlúcar de Barrameda">Sanlúcar de Barrameda</a> | <a href="#" onclick="fm('Tarifa');return false" data-munic="Tarifa">Tarifa</a> | <a href="#" onclick="fm('Ubrique');return false" data-munic="Ubrique">Ubrique</a> | <a href="#" onclick="fm('Vejer de la Frontera');return false" data-munic="Vejer de la Frontera">Vejer de la Frontera</a>
</div>

<p><strong>No hay alertas activas en este momento.</strong></p>
<p>Consulta las fuentes oficiales para información en tiempo real.</p>

<p><strong>Fuente oficial:</strong></p>
<ul>
<li><strong>AEMET</strong> - Alertas meteorol&oacute;gicas: <a href="https://www.aemet.es/es/eltiempo/prediccion/avisos">aemet.es/avisos</a></li>
</ul>

<hr>

<h2>LLAMADAS DE EMERGENCIA</h2>

<h3>Emergencias Generales</h3>
<ul>
<li><strong>112</strong> - Emergencias (Polic&iacute;a, Bomberos, Ambulancia) - <a href="tel:112">Llamar</a></li>
<li><strong>091</strong> - Polic&iacute;a Nacional - <a href="tel:091">Llamar</a></li>
<li><strong>062</strong> - Guardia Civil - <a href="tel:062">Llamar</a></li>
<li><strong>080/085</strong> - Bomberos (var&iacute;a por comunidad) - <a href="tel:080">Llamar</a></li>
<li><strong>061</strong> - Urgencias Sanitarias - <a href="tel:061">Llamar</a></li>
</ul>

<h3>Emergencias Especializadas</h3>
<ul>
<li><strong>016</strong> - Violencia de G&eacute;nero (no deja rastro en factura) - <a href="tel:016">Llamar</a></li>
<li><strong>024</strong> - Atenci&oacute;n a la Conducta Suicida - <a href="tel:024">Llamar</a></li>
</ul>

<hr>

<details>
<summary><strong>GU&Iacute;AS R&Aacute;PIDAS DE ACTUACI&Oacute;N</strong></summary>

<h3>DANA / INUNDACIONES</h3>
<ul>
<li>NO cruces zonas inundadas a pie ni en veh&iacute;culo</li>
<li>Al&eacute;jate de barrancos, ramblas y cauces secos</li>
<li>Si est&aacute;s en un veh&iacute;culo y empieza a flotar, ABAND&Oacute;NALO</li>
<li>Busca terreno elevado</li>
<li>NO bajes a s&oacute;tanos o garajes</li>
<li>Corta la electricidad si hay agua en casa</li>
</ul>

<h3>INCENDIOS FORESTALES</h3>
<ul>
<li>Llama al 112 inmediatamente</li>
<li>Evac&uacute;a si las autoridades lo ordenan - NO ESPERES</li>
<li>NO huyas monte arriba, el fuego sube m&aacute;s r&aacute;pido</li>
</ul>

<h3>OLAS DE CALOR</h3>
<ul>
<li>Hidr&aacute;tate constantemente</li>
<li>Evita salir entre 12h y 17h</li>
<li>Vigila a ancianos, ni&ntilde;os y enfermos cr&oacute;nicos</li>
<li>Golpe de calor: llama al 112 y enfr&iacute;a el cuerpo con agua</li>
</ul>

<h3>TORMENTAS Y VIENTO FUERTE</h3>
<ul>
<li>Busca refugio en edificios s&oacute;lidos</li>
<li>Al&eacute;jate de &aacute;rboles, postes y estructuras altas</li>
<li>Evita usar tel&eacute;fonos con cable durante tormentas el&eacute;ctricas</li>
<li>NO te refugies bajo &aacute;rboles aislados</li>
</ul>
</details>

<hr>

<p><small>ChipiTiempo - Datos de <a href="https://www.aemet.es">AEMET</a>. No sustituye los servicios oficiales. En caso de emergencia, llama al <strong>112</strong>.</small></p>

<script>
var currentProvince = '';
var currentMunicipality = '';

function updateAlertsDisplay() {
    var items = document.querySelectorAll('.al');
    for (var i = 0; i < items.length; i++) {
        var p = ',' + items[i].getAttribute('data-provinces') + ',';
        var m = ',' + items[i].getAttribute('data-municipalities') + ',';

        var provMatch = !currentProvince || p.indexOf(',' + currentProvince + ',') >= 0;
        var municMatch = !currentMunicipality || m.indexOf(',' + currentMunicipality + ',') >= 0;

        items[i].style.display = (provMatch && municMatch) ? '' : 'none';
    }
    var groups = document.querySelectorAll('.src-group');
    for (var i = 0; i < groups.length; i++) {
        var els = groups[i].querySelectorAll('.al');
        var any = false;
        for (var j = 0; j < els.length; j++) {
            if (els[j].style.display !== 'none') { any = true; break; }
        }
        groups[i].style.display = any ? '' : 'none';
    }
}

function fp(prov) {
    currentProvince = prov;
    updateAlertsDisplay();
    var links = document.querySelectorAll('.prov-filter a');
    for (var i = 0; i < links.length; i++) {
        links[i].style.fontWeight = (links[i].getAttribute('data-prov') === (prov || '')) ? 'bold' : 'normal';
    }
}

function fm(munic) {
    currentMunicipality = munic;
    updateAlertsDisplay();
    var links = document.querySelectorAll('.munic-filter a');
    for (var i = 0; i < links.length; i++) {
        links[i].style.fontWeight = (links[i].getAttribute('data-munic') === (munic || '')) ? 'bold' : 'normal';
    }
}

// Función para cargar la previsión de un municipio
function loadForecast(municipality) {
    var loadingSpan = document.getElementById('forecast-loading');
    var contentDiv = document.getElementById('forecast-content');
    
    if (loadingSpan) loadingSpan.style.display = 'inline';
    
    // Llamar a la API para obtener la previsión
    var apiUrl = 'api.php?action=forecast&municipality=' + encodeURIComponent(municipality);
    
    fetch(apiUrl)
        .then(function(response) {
            return response.json();
        })
        .then(function(data) {
            if (loadingSpan) loadingSpan.style.display = 'none';
            
            if (!data.success || !data.hours || data.hours.length === 0) {
                contentDiv.innerHTML = '<p>No hay datos de previsión disponibles para ' + municipality + '.</p>';
                return;
            }
            
            // Actualizar el título de la sección
            var h2 = document.querySelector('h2');
            var locationText = data.municipality || municipality;
            if (data.province) {
                locationText += ' (' + data.province + ')';
            }
            h2.textContent = 'PREVISIÓN HORARIA — ' + locationText;
            
            // Renderizar la tabla de previsión
            contentDiv.innerHTML = renderForecastTable(data.hours);
        })
        .catch(function(error) {
            if (loadingSpan) loadingSpan.style.display = 'none';
            contentDiv.innerHTML = '<p>Error al cargar la previsión: ' + error.message + '</p>';
        });
}

// Función para renderizar la tabla de previsión
function renderForecastTable(hours) {
    var now = new Date().toISOString().substr(0, 13) + ':00:00';
    
    // Filtrar horas futuras
    var filtered = hours.filter(function(h) {
        return h.datetime >= now;
    });
    if (filtered.length === 0) {
        filtered = hours;
    }
    
    // Agrupar por día
    var byDay = {};
    filtered.forEach(function(h) {
        var date = h.datetime.substr(0, 10);
        if (!byDay[date]) {
            byDay[date] = [];
        }
        byDay[date].push(h);
    });
    
    var html = '';
    var months = ['', 'enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'];
    var today = new Date().toISOString().substr(0, 10);
    var tomorrow = new Date(Date.now() + 86400000).toISOString().substr(0, 10);
    
    for (var date in byDay) {
        var dayHours = byDay[date];
        
        // Calcular temperaturas máxima y mínima
        var temps = dayHours.map(function(h) { return h.temperature; }).filter(function(t) { return t !== null; });
        var maxTemp = temps.length > 0 ? Math.max.apply(null, temps) : null;
        var minTemp = temps.length > 0 ? Math.min.apply(null, temps) : null;
        
        // Formatear fecha
        var parts = date.split('-');
        var day = parseInt(parts[2], 10);
        var month = months[parseInt(parts[1], 10)];
        var prefix = '';
        if (date === today) {
            prefix = 'Hoy, ';
        } else if (date === tomorrow) {
            prefix = 'Mañana, ';
        }
        var dayLabel = prefix + day + ' de ' + month;
        
        var tempRange = '';
        if (maxTemp !== null && minTemp !== null) {
            tempRange = ' — Mín: ' + minTemp + '° / Máx: ' + maxTemp + '°';
        }
        
        html += '<h3>' + dayLabel + tempRange + '</h3>
';
        html += '<div class="forecast-scroll"><table class="forecast">
';
        html += '<tr><th>Hora</th><th>°C</th><th>Sens.</th><th>Viento</th><th>Prob.</th><th>Lluvia</th><th>Cielo</th></tr>
';
        
        dayHours.forEach(function(h) {
            var hour = h.datetime.substr(11, 5);
            var temp = h.temperature !== null ? h.temperature + '°' : '-';
            var feels = h.feels_like !== null ? h.feels_like + '°' : '-';
            
            var windStr = '-';
            if (h.wind_dir && h.wind_speed !== null) {
                var arrows = {'N':'↑','NE':'↗','E':'→','SE':'↘','S':'↓','SO':'↙','O':'←','NO':'↖','C':'○'};
                var arrow = arrows[h.wind_dir] || '';
                windStr = arrow + ' ' + h.wind_dir + ' ' + h.wind_speed + ' km/h';
                if (h.wind_gust && h.wind_gust > h.wind_speed) {
                    windStr += ' <small>(racha ' + h.wind_gust + ')</small>';
                }
            }
            
            var rainProb = h.precip_prob !== null ? h.precip_prob + '%' : '-';
            var rainAmount = '-';
            if (h.precip_prob > 0 && h.precip_amount && h.precip_amount !== '0') {
                rainAmount = h.precip_amount + ' mm';
            }
            
            var sky = h.sky_description || '-';
            
            var probClass = '';
            if (h.precip_prob >= 60) {
                probClass = ' class="rain-high"';
            } else if (h.precip_prob >= 30) {
                probClass = ' class="rain-med"';
            }
            
            html += '<tr>';
            html += '<td><strong>' + hour + '</strong></td>';
            html += '<td>' + temp + '</td>';
            html += '<td>' + feels + '</td>';
            html += '<td>' + windStr + '</td>';
            html += '<td' + probClass + '>' + rainProb + '</td>';
            html += '<td>' + rainAmount + '</td>';
            html += '<td>' + sky + '</td>';
            html += '</tr>
';
        });
        
        html += '</table></div>
';
    }
    
    return html;
}

// Inicializar mostrando todas las alertas por defecto
document.addEventListener('DOMContentLoaded', function() {
    // No aplicar filtro por defecto, mostrar todas las alertas
});
</script>

</body>
</html>